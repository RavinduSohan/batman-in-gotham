<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶á Batman: Gotham Guardian</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: none;
        }
        
        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: linear-gradient(180deg, #0f0f23 0%, #1a1a2e 30%, #16213e 100%);
            border: 3px solid #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .game-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #ffd700;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 10;
        }
        
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #ffd700;
            text-align: center;
            font-size: 16px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: #ffd700;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #ffd700;
            display: none;
            z-index: 20;
        }
        
        .restart-btn {
            background: #ffd700;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 15px;
            font-weight: bold;
        }
        
        .restart-btn:hover {
            background: #ffed4e;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="game-ui">
        <div>üèÜ Score: <span id="score">0</span></div>
        <div>‚ù§Ô∏è Lives: <span id="lives">3</span></div>
    </div>
    
    <canvas id="gameCanvas"></canvas>
    
    <div class="instructions">
        <div>üéÆ Tap to make Batman fly up! Catch the villains! ü¶π‚Äç‚ôÇÔ∏è</div>
    </div>
    
    <div class="game-over" id="gameOver">
        <h2>ü¶á GAME OVER ü¶á</h2>
        <p>Final Score: <span id="finalScore">0</span></p>
        <p>Gotham needs you, Batman!</p>
        <button class="restart-btn" onclick="restartGame()">üîÑ Play Again</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Set canvas size for mobile
        function resizeCanvas() {
            canvas.width = Math.min(window.innerWidth - 20, 400);
            canvas.height = Math.min(window.innerHeight - 100, 600);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // Game variables
        let gameRunning = true;
        let score = 0;
        let lives = 3;
        let gameSpeed = 2;
        
        // Batman object
        const batman = {
            x: 50,
            y: canvas.height / 2,
            width: 40,
            height: 40,
            velocity: 0,
            gravity: 0.5,
            jumpPower: -8,
            emoji: 'ü¶á'
        };
        
        // Buildings array
        const buildings = [];
        const buildingEmojis = ['üè¢', 'üè¨', 'üè≠', 'üè™', 'üè´'];
        
        // Villains array
        const villains = [];
        const villainEmojis = ['üÉè', 'üêß', '‚ùÑÔ∏è', 'üíÄ', 'üëπ', 'üé≠'];
        
        // Particles for effects
        const particles = [];
        
        // Initialize buildings
        function createBuilding() {
            const height = Math.random() * 200 + 100;
            buildings.push({
                x: canvas.width,
                y: canvas.height - height,
                width: 60,
                height: height,
                emoji: buildingEmojis[Math.floor(Math.random() * buildingEmojis.length)]
            });
        }
        
        // Initialize villains in open spaces
        function createVillain() {
            // Find a safe Y position that's not inside a building
            let safeY;
            let attempts = 0;
            const maxAttempts = 20;
            
            do {
                // Try a random position
                safeY = Math.random() * (canvas.height - 150) + 50;
                attempts++;
                
                // If we've tried too many times, just pick a reasonable default
                if (attempts >= maxAttempts) {
                    safeY = canvas.height / 2;
                    break;
                }
                
            // Check if this position overlaps with any building
            } while (buildings.some(building => {
                const buildingTop = building.y;
                const buildingBottom = canvas.height;
                const villainTop = safeY;
                const villainBottom = safeY + 35;
                
                // Check if villain would be inside this building
                return (villainTop >= buildingTop && villainTop <= buildingBottom) ||
                       (villainBottom >= buildingTop && villainBottom <= buildingBottom) ||
                       (villainTop <= buildingTop && villainBottom >= buildingBottom);
            }));
            
            villains.push({
                x: canvas.width,
                y: safeY,
                width: 35,
                height: 35,
                emoji: villainEmojis[Math.floor(Math.random() * villainEmojis.length)],
                caught: false
            });
        }
        
        // Create particles
        function createParticle(x, y, color) {
            for (let i = 0; i < 5; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 4,
                    vy: (Math.random() - 0.5) * 4,
                    life: 30,
                    color: color
                });
            }
        }
        
        // Draw emoji with size
        function drawEmoji(emoji, x, y, size) {
            ctx.font = `${size}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(emoji, x + size/2, y + size/2);
        }
        
        // Draw Batman with glow effect
        function drawBatman() {
            // Glow effect
            ctx.shadowColor = '#ffd700';
            ctx.shadowBlur = 10;
            drawEmoji(batman.emoji, batman.x, batman.y, batman.width);
            ctx.shadowBlur = 0;
        }
        
        // Draw buildings
        function drawBuildings() {
            buildings.forEach(building => {
                // Building shadow
                ctx.fillStyle = 'rgba(0,0,0,0.3)';
                ctx.fillRect(building.x + 5, building.y + 5, building.width, building.height);
                
                // Building
                ctx.fillStyle = '#2c3e50';
                ctx.fillRect(building.x, building.y, building.width, building.height);
                
                // Windows
                ctx.fillStyle = '#ffd700';
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < Math.floor(building.height / 30); j++) {
                        if (Math.random() > 0.3) {
                            ctx.fillRect(
                                building.x + 10 + i * 15,
                                building.y + 10 + j * 25,
                                8, 12
                            );
                        }
                    }
                }
                
                // Building emoji on top
                drawEmoji(building.emoji, building.x + 15, building.y - 20, 30);
            });
        }
        
        // Draw villains
        function drawVillains() {
            villains.forEach(villain => {
                if (!villain.caught) {
                    // Villain glow
                    ctx.shadowColor = '#ff0000';
                    ctx.shadowBlur = 8;
                    drawEmoji(villain.emoji, villain.x, villain.y, villain.width);
                    ctx.shadowBlur = 0;
                }
            });
        }
        
        // Draw particles
        function drawParticles() {
            particles.forEach((particle, index) => {
                ctx.fillStyle = particle.color;
                ctx.fillRect(particle.x, particle.y, 3, 3);
                
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.life--;
                
                if (particle.life <= 0) {
                    particles.splice(index, 1);
                }
            });
        }
        
        // Draw background stars
        function drawStars() {
            ctx.fillStyle = '#ffd700';
            for (let i = 0; i < 20; i++) {
                const x = (i * 37) % canvas.width;
                const y = (i * 23) % (canvas.height / 2);
                ctx.fillRect(x, y, 2, 2);
            }
        }
        
        // Collision detection
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }
        
        // Update game
        function update() {
            if (!gameRunning) return;
            
            // Update Batman
            batman.velocity += batman.gravity;
            batman.y += batman.velocity;
            
            // Keep Batman in bounds
            if (batman.y < 0) batman.y = 0;
            if (batman.y > canvas.height - batman.height) {
                batman.y = canvas.height - batman.height;
                batman.velocity = 0;
            }
            
            // Update buildings
            buildings.forEach((building, index) => {
                building.x -= gameSpeed;
                if (building.x + building.width < 0) {
                    buildings.splice(index, 1);
                }
            });
            
            // Update villains
            villains.forEach((villain, index) => {
                villain.x -= gameSpeed;
                
                // Check collision with Batman
                if (!villain.caught && checkCollision(batman, villain)) {
                    villain.caught = true;
                    score += 10;
                    createParticle(villain.x, villain.y, '#ffd700');
                    document.getElementById('score').textContent = score;
                }
                
                if (villain.x + villain.width < 0) {
                    if (!villain.caught) {
                        lives--;
                        document.getElementById('lives').textContent = lives;
                        if (lives <= 0) {
                            gameOver();
                        }
                    }
                    villains.splice(index, 1);
                }
            });
            
            // Check building collision
            buildings.forEach(building => {
                if (checkCollision(batman, building)) {
                    lives--;
                    document.getElementById('lives').textContent = lives;
                    createParticle(batman.x, batman.y, '#ff0000');
                    if (lives <= 0) {
                        gameOver();
                    } else {
                        batman.y = canvas.height / 2;
                        batman.velocity = 0;
                    }
                }
            });
            
            // Spawn buildings less frequently and only if there aren't too many
            if (buildings.length < 2 && Math.random() < 0.008) createBuilding();
            
            // Spawn villains much less frequently and only one at a time
            if (villains.length < 1 && Math.random() < 0.015) createVillain();
        }
        
        // Draw everything
        function draw() {
            // Clear canvas with night gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#0f0f23');
            gradient.addColorStop(0.3, '#1a1a2e');
            gradient.addColorStop(1, '#16213e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            drawStars();
            drawBuildings();
            drawVillains();
            drawBatman();
            drawParticles();
        }
        
        // Game loop
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Game over
        function gameOver() {
            gameRunning = false;
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOver').style.display = 'block';
        }
        
        // Restart game
        function restartGame() {
            gameRunning = true;
            score = 0;
            lives = 3;
            gameSpeed = 2;
            batman.y = canvas.height / 2;
            batman.velocity = 0;
            buildings.length = 0;
            villains.length = 0;
            particles.length = 0;
            
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            document.getElementById('gameOver').style.display = 'none';
        }
        
        // Controls
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameRunning) {
                batman.velocity = batman.jumpPower;
            }
        });
        
        canvas.addEventListener('click', () => {
            if (gameRunning) {
                batman.velocity = batman.jumpPower;
            }
        });
        
        // Prevent scrolling on mobile
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });
        
        // Start game
        gameLoop();
    </script>
</body>
</html>